<!DOCTYPE html><html lang="ko-KR" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="일 전"><meta name="hour-prompt" content="시간 전"><meta name="minute-prompt" content="분 전"><meta name="justnow-prompt" content="방금"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기" /><meta name="author" content="bactoria" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="지난번에 6주간 했던 푸드트럭 프로젝트는 Nginx를 이용하면서 액세스 로그를 쌓아왔기에, 이를 Kibana로 시각화하고 싶었다." /><meta property="og:description" content="지난번에 6주간 했던 푸드트럭 프로젝트는 Nginx를 이용하면서 액세스 로그를 쌓아왔기에, 이를 Kibana로 시각화하고 싶었다." /><link rel="canonical" href="https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/" /><meta property="og:url" content="https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/" /><meta property="og:site_name" content="Bactoria" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-03-24T00:12:12+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@bactoria" /><meta name="google-site-verification" content="google7bf670670a870e33.html" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"bactoria"},"description":"지난번에 6주간 했던 푸드트럭 프로젝트는 Nginx를 이용하면서 액세스 로그를 쌓아왔기에, 이를 Kibana로 시각화하고 싶었다.","url":"https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/","@type":"BlogPosting","headline":"엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기","dateModified":"2020-04-12T02:40:01+00:00","datePublished":"2020-03-24T00:12:12+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/"},"@context":"https://schema.org"}</script><title>엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기 | Bactoria</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Bactoria"><meta name="application-name" content="Bactoria"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="ko-KR"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/25674959?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Bactoria</a></div><div class="site-subtitle font-italic">for Self-Motivation</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/bactoria" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['bactoria','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/bactoria">bactoria</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" date="2020-03-24 00:12:12 +0000" data-toggle="tooltip" data-placement="bottom" title="2020-03-24, 00:12 +0000" >2020년 03월 24일</em> </span> <span> 업데이트 <em class="timeago" date="2020-04-12 11:40:01 +0900 " data-toggle="tooltip" data-placement="bottom" title="2020-04-12, 11:40 +0900" >2020년 04월 12일</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1073 단어"> <em>5 분</em>읽는 시간</span></div></div></div><div class="post-content"><p>지난번에 6주간 했던 푸드트럭 프로젝트는 Nginx를 이용하면서 액세스 로그를 쌓아왔기에, 이를 Kibana로 시각화하고 싶었다.</p><p>목표는 이용자들의 인기검색어를 Kibana로 모니터링 해보는 것.</p><hr /><h3 id="개발-환경">개발 환경<a href="#개발-환경" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>OS : Ubuntu 18.04.1 LTS<ul><li>Nginx : 1.14.0<li>Logstash: 7.4.1</ul><li>ElasticSearch: Amazon Elasticsearch Service (7.4)<li>Kibana: Amazon Elasticsearch Service (7.4)</ul><p> </p><h3 id="대략적인-인프라는-todo">대략적인 인프라는 (TODO)<a href="#대략적인-인프라는-todo" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><hr /><h3 id="nginx-로그-쌓기">Nginx 로그 쌓기<a href="#nginx-로그-쌓기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>인기검색어를 뽑아내기 위해서는 사용자가 검색했던 데이터를 어딘가에 기록해두어야 한다.</p><p>우리 프로젝트는 Nginx로 들어오는 로그를 남긴다.</p><p> </p><p><strong>/etc/nginx/nginx.conf</strong></p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1"># ...</span>

<span class="k">http</span> <span class="p">{</span>
    <span class="c1"># ...</span>
  
    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">'</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local</span><span class="s">]</span> <span class="s">"</span><span class="nv">$request</span><span class="s">"</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">"</span><span class="nv">$http_referer</span><span class="s">"</span> <span class="s">"</span><span class="nv">$http_user_agent</span><span class="s">"'</span><span class="p">;</span>
  
    <span class="kn">access_log</span> <span class="n">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="n">/var/log/nginx/error.log</span><span class="p">;</span>

    <span class="kn">server</span> <span class="p">{</span>
		    <span class="c1"># ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>/var/log/nginx/access.log 에 main format으로 남긴다는 말이다.</p><p> </p><p><strong>/var/log/nginx/access.log</strong> 는 아래처럼 찍힌다.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="mf">14.52</span><span class="err">.</span><span class="mf">151.97</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="p">[</span><span class="mi">23</span><span class="err">/Mar/</span><span class="mi">2020</span><span class="err">:</span><span class="mi">15</span><span class="err">:</span><span class="mi">41</span><span class="err">:</span><span class="mi">13</span><span class="w"> </span><span class="err">+</span><span class="mi">0000</span><span class="p">]</span><span class="w"> </span><span class="s2">"GET /favicon.ico HTTP/1.1"</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="mi">292</span><span class="w"> </span><span class="s2">"https://food-truck.shop/"</span><span class="w"> </span><span class="s2">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span><span class="w">
</span><span class="mf">14.52</span><span class="err">.</span><span class="mf">151.97</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="p">[</span><span class="mi">23</span><span class="err">/Mar/</span><span class="mi">2020</span><span class="err">:</span><span class="mi">15</span><span class="err">:</span><span class="mi">41</span><span class="err">:</span><span class="mi">13</span><span class="w"> </span><span class="err">+</span><span class="mi">0000</span><span class="p">]</span><span class="w"> </span><span class="s2">"GET /manifest.json HTTP/1.1"</span><span class="w"> </span><span class="mi">304</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="s2">"https://food-truck.shop/"</span><span class="w"> </span><span class="s2">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span><span class="w">
</span><span class="mf">14.52</span><span class="err">.</span><span class="mf">151.97</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="p">[</span><span class="mi">23</span><span class="err">/Mar/</span><span class="mi">2020</span><span class="err">:</span><span class="mi">15</span><span class="err">:</span><span class="mi">41</span><span class="err">:</span><span class="mi">13</span><span class="w"> </span><span class="err">+</span><span class="mi">0000</span><span class="p">]</span><span class="w"> </span><span class="s2">"GET /logo192.png HTTP/1.1"</span><span class="w"> </span><span class="mi">304</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="s2">"https://food-truck.shop/"</span><span class="w"> </span><span class="s2">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="elk--구축">ELK 구축<a href="#elk--구축" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="amazon-elasticsearch-service-인스턴스-생성하기">Amazon Elasticsearch Service 인스턴스 생성하기<a href="#amazon-elasticsearch-service-인스턴스-생성하기" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p><img width="278" alt="스크린샷 2020-03-19 오후 4 41 11" data-src="https://user-images.githubusercontent.com/25674959/77043244-75602180-6a00-11ea-9ac4-7191379e279d.png" data-proofer-ignore></p><p>AWS의 Amazon Elasticsearch Service는 프리티어로 1년간 무료로 사용할 수 있는 인스턴스가 있다.</p><p>인스턴스를 생성하면 아래처럼 <strong>Elasticsearch</strong> 엔드포인트와 <strong>Kibana</strong> 주소가 나온다</p><p><img data-src="https://user-images.githubusercontent.com/25674959/77338780-2acb0600-6d6e-11ea-8a68-3695ded263d6.png" alt="image" data-proofer-ignore></p><hr /><h3 id="iam-사용자-생성하기">IAM 사용자 생성하기<a href="#iam-사용자-생성하기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Logstash에서 Elasticsearh로 데이터를 전송할 때 <strong>유효한 사용자인지를 식별</strong>하는 과정이 필요하다.</p><p>이를 IAM을 이용하여 해결하려 한다.</p><ul><li>정책<ul><li>정책 생성<ul><li>서비스: Elasticsearch Service<li>작업: 액세스 레벨 - 쓰기<li>리소스: 특정 - 모두 선택</ul><li>정책 검토<ul><li>이름: «정책 이름»</ul></ul><li>사용자<ul><li>사용자 추가<ul><li>사용자 세부 정보 설정<ul><li>사용자 이름: «사용자 이름»</ul><li>AWS 액세스 유형 선택<ul><li>액세스 유형: 프로그래밍 방식 액세스</ul><li>권한 설정<ul><li>기존 정책 직접 연결<ul><li>«위에서 생성한 정책 이름» 선택</ul></ul></ul></ul></ul><p><img data-src="https://user-images.githubusercontent.com/25674959/77045006-c4f41c80-6a03-11ea-9d50-cb0d8571f5f4.png" alt="image" data-proofer-ignore></p><p><strong>액세스 키</strong>와 <strong>비밀 액세스 키</strong>는 나중에 Logstash 설정할 때 사용하니 따로 기록해둔다.</p><hr /><h3 id="logstash">Logstash<a href="#logstash" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Logstash를 우리 프로젝트가 배포되어있는 EC2 인스턴스에 설치한다.</p><p>아래 명령어들은 <strong>Ubuntu 18.04.1 LTS</strong> 기준이다.</p><p> </p><p><strong>Logstash 설치</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">sudo </span>wget https://artifacts.elastic.co/downloads/logstash/logstash-7.4.1.deb
<span class="o">&gt;</span> <span class="nb">sudo </span>dpkg <span class="nt">-i</span> logstash-7.4.1.deb
</pre></table></code></div></div><p> </p><p><strong>플러그인 설치</strong> - Logstash에서 Elasticsearch(Amazon es)로 데이터 전송을 도와주는 플러그인 (output 에서 사용됨.)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">sudo</span> /usr/share/logstash/bin/logstash-plugin <span class="nb">install </span>logstash-output-amazon_es
</pre></table></code></div></div><p> </p><p><strong>Logstash 메모리 설정 변경</strong></p><p>Logstash가 실행되면 기본적으로 초기,최대 힙 사이즈가 1GB로 설정되어 있다.</p><p>각자 인스턴스 사정에 맞게 힙사이즈를 조정한다.</p><p>EC2 프리티어 (t2.micro) 의 경우 램이 1기가라서 줄여놓는 것이 기존 서비스에 영향이 덜 갈 것이다.</p><p> </p><p><strong>/etc/logstash/jvm.options</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">-Xms256M</span> <span class="c"># JVM의 초기 힙 사이즈</span>
<span class="nt">-Xmx256M</span> <span class="c"># JVM의 최대 힙 사이즈</span>

<span class="c"># ...</span>
</pre></table></code></div></div><hr /><h3 id="elasticsearch-로-accesslog-전송하기">Elasticsearch 로 Access.log 전송하기<a href="#elasticsearch-로-accesslog-전송하기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>이제 Logstash 설정만 해주면 Elasticsearch로 로그를 전송할 수 있다.</p><p> </p><p><strong>/etc/logstash/conf.d/logstash-test.conf</strong></p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span label-text="Ruby"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="n">input</span> <span class="p">{</span>
  <span class="n">file</span> <span class="p">{</span>
    <span class="n">path</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"/var/log/nginx/access.log"</span><span class="p">]</span>
    <span class="n">sincedb_path</span> <span class="o">=&gt;</span> <span class="s2">"/dev/null"</span>
    <span class="n">start_position</span> <span class="o">=&gt;</span> <span class="s2">"beginning"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">filter</span> <span class="p">{</span> <span class="p">}</span>

<span class="n">output</span> <span class="p">{</span>
  <span class="n">amazon_es</span> <span class="p">{</span>
    <span class="n">hosts</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"search-####-#####.ap-northeast-2.es.amazonaws.com"</span><span class="p">]</span> <span class="c1"># Amazon Elasticsearch service 엔드포인트</span>
    <span class="n">region</span> <span class="o">=&gt;</span> <span class="s2">"ap-northeast-2"</span> <span class="c1"># Amazon Elasticsearch service 인스턴스의 지역</span>
    <span class="n">index</span> <span class="o">=&gt;</span> <span class="s2">"nginx-access.log-%{+YYYY.MM}"</span>
    <span class="n">aws_access_key_id</span> <span class="o">=&gt;</span> <span class="s1">'#####################'</span> <span class="c1"># 위에서 발급한 사용자 액세스 키</span>
    <span class="n">aws_secret_access_key</span> <span class="o">=&gt;</span> <span class="s1">'##############################'</span> <span class="c1"># 위에서 발급한 사용자 비밀 액세스 키</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p> </p><p><strong>Logstash 실행</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">sudo </span>service logstash start
</pre></table></code></div></div><hr /><h3 id="kibana로-로그-확인">Kibana로 로그 확인<a href="#kibana로-로그-확인" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>Dev Tools로 확인하기</strong></p><p><img data-src="https://user-images.githubusercontent.com/25674959/77335056-fd2f8e00-6d68-11ea-9934-3901bc458371.png" alt="image" data-proofer-ignore></p><p>인덱스명은 <strong>nginx</strong>* 로, 와일드카드를 사용할 수 있다. (nginx 로 시작하는 인덱스들 모두가 검색 대상이다.)</p><p><strong>Discover 로 확인하기</strong></p><p><img data-src="https://user-images.githubusercontent.com/25674959/77335305-53043600-6d69-11ea-9539-87c7f7958641.png" alt="image" data-proofer-ignore></p><hr /><p>지금껏 Nginx의 Access.log 파일을 Elasticsearch로 넣어보고,</p><p>넣은 데이터를 Kibana로 확인하는 작업을 했다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/elasticsearch/'>Elasticsearch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기 - Bactoria&url=https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기 - Bactoria&u=https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기 - Bactoria&url=https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2022/02/04/2022%EB%85%84-1%EC%9B%94-%ED%9A%8C%EA%B3%A0/">2022년 1월 회고</a><li><a href="/2022/01/02/2021%EB%85%84-%ED%9A%8C%EA%B3%A0/">2021년 회고</a><li><a href="/2020/04/19/%EB%A7%88%EC%8A%A4%ED%81%AC-%EA%B5%AC%EB%A7%A4-%EC%95%8C%EB%A6%AC%EB%AF%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%9B%84%EA%B8%B0/">마스크 구매 알리미 서비스 후기</a><li><a href="/2021/08/15/%EA%B3%A0%EC%96%91%EC%8B%9C-%EB%85%B8%EA%B3%A0%EC%82%B0-%EB%B0%B1%ED%8C%A8%ED%82%B9/">고양시 노고산 백패킹</a><li><a href="/2021/05/16/2021%EB%85%84-19%EC%A3%BC%EC%B0%A8-%ED%9A%8C%EA%B3%A0/">2021년 19주차 회고</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%EA%B3%B5%EB%AA%A8%EC%A0%84/">공모전</a> <a class="post-tag" href="/tags/%EB%B9%85%EC%8A%A4%EB%B9%84%EC%B1%8C%EB%A6%B0%EC%A7%80/">빅스비챌린지</a> <a class="post-tag" href="/tags/%EC%9D%B4%EB%B2%88%EC%A3%BC%EC%97%90%EA%B5%AC%EB%A7%A4%ED%95%9C%EC%B1%85/">이번주에구매한책</a> <a class="post-tag" href="/tags/%EA%B0%9C%EB%B0%9C/">개발</a> <a class="post-tag" href="/tags/%EA%B5%AC%EA%B8%80%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EC%9E%BC/">구글클라우드잼</a> <a class="post-tag" href="/tags/%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8/">오브젝트</a> <a class="post-tag" href="/tags/%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC%EC%BD%94%EC%8A%A4/">우아한테크코스</a> <a class="post-tag" href="/tags/%EC%B7%A8%EC%97%85/">취업</a> <a class="post-tag" href="/tags/%ED%94%BC%EB%93%9C%EB%B0%B1/">피드백</a> <a class="post-tag" href="/tags/coc/">CoC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(2)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9E%98-%EC%8C%93%EA%B8%B0/"><div class="card-body"> <em class="timeago small" date="2020-03-24 02:59:12 +0000" >2020년 03월 24일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>엘라스틱서치로 인기검색어 모니터링 해보자 (2) - 엘라스틱서치에 데이터 예쁘게 쌓기</h3><div class="text-muted small"><p> 지난번에 6주간 했던 푸드트럭 프로젝트는 Nginx를 이용하면서 액세스 로그를 쌓아왔기에, 이를 Kibana로 시각화하고 싶었다. 목표는 이용자들의 인기검색어를 Kibana로 모니터링 해보는 것. 이전글 (엘라스틱서치로 인기검색어 모니터링 해보자 (1) - 엘라스틱서치에 액세스로그 쌓기) 에서 액세스로그를 Elasticsearch로 저장하였고, ...</p></div></div></a></div><div class="card"> <a href="/2020/04/12/%EB%A1%9C%EA%B7%B8%EC%8A%A4%ED%83%9C%EC%8B%9C-mutate-filter-plugin-%ED%8C%8C%ED%97%A4%EC%B9%98%EA%B8%B0/"><div class="card-body"> <em class="timeago small" date="2020-04-12 04:20:12 +0000" >2020년 04월 12일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>로그스태시 mutate filter plugin 파헤치기</h3><div class="text-muted small"><p> raw data를 Elasticsearch로 밀어넣기 전에, 사용하기 편하도록 가공이 필요하다. 이는 Logstash의 filter로 해결할 수 있는데, 특정 필드를 가공하는 방법 중에 mutate filter plugin 가 있다. 해당 플러그인은 공식문서에 설명이 잘 되어있다. ( 공식문서에서의 mutate filter plugin 의 ...</p></div></div></a></div><div class="card"> <a href="/2022/02/04/2022%EB%85%84-1%EC%9B%94-%ED%9A%8C%EA%B3%A0/"><div class="card-body"> <em class="timeago small" date="2022-02-04 07:26:33 +0000" >2022년 02월 04일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2022년 1월 회고</h3><div class="text-muted small"><p> 코드 리뷰어 2022 공채 신입 코드리뷰어 로 활동하고 있다. 조직에 합류하기 전 인턴 때 코드 리뷰를 받으면서 많이 성장했다고 느꼈기에 나도 되돌려주고 싶었다. 코드 리뷰는 대부분 업무시간을 할애하긴 하지만, 새벽에 리뷰를 하는 경우도 있어 체력적으로 힘이 들었는데, 뉴크루가 성장하는 모습이 너무 대놓고 보여서 뿌듯함을 느낀다. 리뷰이가 앞으로 조...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2020/02/02/2020%EB%85%84-5%EC%A3%BC%EC%B0%A8-%ED%9A%8C%EA%B3%A0/" class="btn btn-outline-primary" prompt="이전 글"><p>2020년 5주차 회고</p></a> <a href="/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(2)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9E%98-%EC%8C%93%EA%B8%B0/" class="btn btn-outline-primary" prompt="다음 글"><p>엘라스틱서치로 인기검색어 모니터링 해보자 (2) - 엘라스틱서치에 데이터 예쁘게 쌓기</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://bactoria.github.io/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/'; this.page.identifier = '/2020/03/24/%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EB%A1%9C-%EC%9D%B8%EA%B8%B0%EA%B2%80%EC%83%89%EC%96%B4-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%95%B4%EB%B3%B4%EC%9E%90-(1)-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4%EB%A1%9C%EA%B7%B8-%EC%8C%93%EA%B8%B0/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://bactoria.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/bactoria">bactoria</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%EA%B3%B5%EB%AA%A8%EC%A0%84/">공모전</a> <a class="post-tag" href="/tags/%EB%B9%85%EC%8A%A4%EB%B9%84%EC%B1%8C%EB%A6%B0%EC%A7%80/">빅스비챌린지</a> <a class="post-tag" href="/tags/%EC%9D%B4%EB%B2%88%EC%A3%BC%EC%97%90%EA%B5%AC%EB%A7%A4%ED%95%9C%EC%B1%85/">이번주에구매한책</a> <a class="post-tag" href="/tags/%EA%B0%9C%EB%B0%9C/">개발</a> <a class="post-tag" href="/tags/%EA%B5%AC%EA%B8%80%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EC%9E%BC/">구글클라우드잼</a> <a class="post-tag" href="/tags/%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8/">오브젝트</a> <a class="post-tag" href="/tags/%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC%EC%BD%94%EC%8A%A4/">우아한테크코스</a> <a class="post-tag" href="/tags/%EC%B7%A8%EC%97%85/">취업</a> <a class="post-tag" href="/tags/%ED%94%BC%EB%93%9C%EB%B0%B1/">피드백</a> <a class="post-tag" href="/tags/coc/">CoC</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
